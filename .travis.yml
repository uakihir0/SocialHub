language: java

os: osx
osx_image: xcode12.5

env:
  matrix:
    - RUN_TARGET=Debug
    - RUN_TARGET=Release

before_script:
  - wget -q https://github.com/google/j2objc/releases/download/2.8/j2objc-2.8.zip
  - unzip -q j2objc-2.8.zip
  - echo "j2objc.home=./j2objc-2.8/" > local.properties

script:
  - travis_wait 50 ./gradlew -b j2objc-apple.gradle clean :j2objcAssemble${RUN_TARGET} -x test

after_success:
  - git config --global user.email "a.urusihara@gmail.com"
  - git config --global user.name "Akihiro Urushihara"
  - cd ./build/j2objcOutputs/
  - git init
  - git checkout -b Travis/${RUN_TARGET}
  - git add --all
  - git commit -m "by Travis CI (JOB $TRAVIS_JOB_NUMBER)"
  - git remote add origin https://${AZ_TOKEN}@dev.azure.com/SocialHub/ObjCBinary/_git/ObjCBinary
  - git push -f origin Travis/${RUN_TARGET}
